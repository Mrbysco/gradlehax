apply from: 'gradle/property_helper.gradle'

if (project.hasProperty("registrate_version") || project.hasProperty("noobutil_version")) {
    def registrate_version = getOptionalString("registrate_version")
    def noobutil_version = getOptionalString("noobutil_version")

    configurations {
        shade
    }

    repositories {
        maven {
            name = "Jared"
            url = "https://maven.blamejared.com"
        }
        maven {
            name = "tterrag"
            url = "http://maven.tterrag.com"
        }
    }

    dependencies {
        if (!registrate_version.isEmpty()) {
            def registrate = "com.tterrag.registrate:Registrate:${registrate_version}"
            implementation fg.deobf(registrate)
            shade registrate
        }

        if (!noobutil_version.isEmpty) {
            def noobutil = "noobanidus.libs:noobutil:${noobutil_version}"
            implementation fg.deobf(noobutil)
            shade noobutil
        }
    }

    shadowJar {
        shadowJar {
            configurations = [project.configurations.shade]
            if (!registrate_version.isEmpty()) {
                relocate "com.tterrag.registrate", "${group}.repack.registrate"
            }
            if (!noobutil_version.isEmpty()) {
                relocate "noobanidus.libs.noobutil", "${group}.repack.noobutil"
            }
            classifier ""
        }
    }

    reobf {
        shadowJar {}
    }

    build.dependsOn reobfShadowJar
}